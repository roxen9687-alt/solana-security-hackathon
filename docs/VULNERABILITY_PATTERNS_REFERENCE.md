# Solana Security Swarm - All Vulnerability Patterns Reference

> **Total Patterns:** 52  
> **Source:** `crates/program-analyzer/src/vulnerability_db.rs`  
> **Last Verified:** 2026-02-09 (from actual source code analysis)

---

## Pattern Categories

| Category | Count | Severity Range |
|----------|-------|----------------|
| Authentication & Authorization | 6 | Critical-High |
| Arithmetic Safety | 6 | Medium-High |
| Account Validation | 6 | Medium-Critical |
| PDA Security | 3 | High |
| CPI Security | 4 | Medium-Critical |
| Reentrancy & DeFi | 4 | Critical |
| Token Security | 6 | Medium-Critical |
| MEV & Slippage | 4 | Medium-High |
| Account Management | 5 | Medium-Critical |
| Miscellaneous | 8 | Low-High |

---

## Complete Pattern List

### Authentication & Authorization

#### SOL-001: Missing Signer Check
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Function accesses authority without `Signer<>` constraint
- **Attack:** Attacker calls function without being the authorized signer
- **Fix:** Add `Signer<'info>` to authority account

#### SOL-003: Missing Owner Check  
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Account used without owner validation
- **Attack:** Attacker passes fake account with matching data structure
- **Fix:** Add `owner = program_id` constraint

#### SOL-029: Missing Close Authority
- **Severity:** HIGH (4)
- **Detection Pattern:** Account closure without authority check
- **Attack:** Anyone can close accounts and steal lamports
- **Fix:** Validate close authority before closure

#### SOL-030: Privilege Escalation
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Authority role can be reassigned without proper checks
- **Attack:** Attacker gains admin privileges
- **Fix:** Require multi-sig or time-lock for authority changes

#### SOL-041: Unrestricted Transfer
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Transfer with no access control
- **Attack:** Anyone can transfer tokens/lamports from vault
- **Fix:** Add signer/authority validation

#### SOL-047: Missing Access Control
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Admin function callable by anyone
- **Attack:** Unauthorized admin operations
- **Fix:** Add role-based access control

---

### Arithmetic Safety

#### SOL-002: Integer Overflow/Underflow
- **Severity:** HIGH (4)
- **Detection Pattern:** Arithmetic without `checked_*` methods
- **Attack:** Overflow to bypass limits or underflow to create tokens
- **Fix:** Use `checked_add()`, `checked_sub()`, `checked_mul()`

#### SOL-037: Division Before Multiplication
- **Severity:** MEDIUM (3)
- **Detection Pattern:** `a / b * c` pattern
- **Attack:** Precision loss leading to fund extraction
- **Fix:** Reorder to `a * c / b`

#### SOL-038: Precision Loss
- **Severity:** HIGH (4)
- **Detection Pattern:** Decimal truncation in calculations
- **Attack:** Rounding errors accumulate to significant losses
- **Fix:** Use higher precision intermediates

#### SOL-039: Rounding Direction Error
- **Severity:** MEDIUM (3)
- **Detection Pattern:** Rounding favors user over protocol
- **Attack:** Repeated small transactions extract value
- **Fix:** Round in protocol's favor

#### SOL-040: Missing Zero Check
- **Severity:** MEDIUM (3)
- **Detection Pattern:** Division without zero check
- **Attack:** Panic or unexpected behavior
- **Fix:** Check divisor before division

#### SOL-045: Unsafe Exponentiation
- **Severity:** HIGH (4)
- **Detection Pattern:** `pow()` without bounds
- **Attack:** Overflow in exponential calculations
- **Fix:** Use `checked_pow()` with limits

---

### Account Validation

#### SOL-004: Type Cosplay
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Account type not validated by discriminator
- **Attack:** Wrong account type passed as parameter
- **Fix:** Validate account discriminator

#### SOL-006: Duplicate Mutable Accounts
- **Severity:** HIGH (4)
- **Detection Pattern:** Same account passed as two mutable params
- **Attack:** Double-spend or state corruption
- **Fix:** Add `constraint = a.key() != b.key()`

#### SOL-011: Reinitialization
- **Severity:** HIGH (4)
- **Detection Pattern:** Init without `is_initialized` check
- **Attack:** Reset account to gain advantage
- **Fix:** Add reinitialization guard

#### SOL-012: Account Data Mismatch
- **Severity:** HIGH (4)
- **Detection Pattern:** Related accounts not cross-validated
- **Attack:** Pass unrelated accounts
- **Fix:** Validate account relationships

#### SOL-013: Missing Rent Exemption
- **Severity:** MEDIUM (3)
- **Detection Pattern:** Account creation without rent check
- **Attack:** Account garbage collected
- **Fix:** Ensure rent-exempt minimum

#### SOL-014: Unsafe Deserialization
- **Severity:** HIGH (4)
- **Detection Pattern:** Deserialize without validation
- **Attack:** Malformed data causes panic
- **Fix:** Handle deserialization errors

---

### PDA Security

#### SOL-007: Bump Seed Issues
- **Severity:** HIGH (4)
- **Detection Pattern:** User-provided bump instead of canonical
- **Attack:** Multiple valid PDAs for same logical account
- **Fix:** Store and verify canonical bump

#### SOL-008: PDA Sharing
- **Severity:** HIGH (4)
- **Detection Pattern:** PDA seeds don't include user identity
- **Attack:** Users share PDA state unexpectedly
- **Fix:** Include user pubkey in seeds

#### SOL-027: Missing Seeds Validation
- **Severity:** HIGH (4)
- **Detection Pattern:** PDA seeds not fully verified
- **Attack:** Wrong PDA accepted
- **Fix:** Derive and compare PDA on-chain

---

### CPI Security

#### SOL-005: Arbitrary CPI
- **Severity:** CRITICAL (5)
- **Detection Pattern:** CPI target from user input
- **Attack:** Call malicious program
- **Fix:** Hardcode or validate program IDs

#### SOL-015: Missing Program ID Check
- **Severity:** CRITICAL (5)
- **Detection Pattern:** CPI without target validation
- **Attack:** Redirect CPI to attacker program
- **Fix:** Validate target program ID

#### SOL-016: Unchecked Return Value
- **Severity:** HIGH (4)
- **Detection Pattern:** CPI result ignored
- **Attack:** Silent failure leads to inconsistent state
- **Fix:** Check and handle CPI result

#### SOL-026: Deep CPI Chain
- **Severity:** MEDIUM (3)
- **Detection Pattern:** >4 levels of CPI nesting
- **Attack:** Stack exhaustion
- **Fix:** Limit CPI depth

---

### Reentrancy & DeFi

#### SOL-017: Cross-Program Reentrancy
- **Severity:** CRITICAL (5)
- **Detection Pattern:** State modification after CPI
- **Attack:** Re-enter before state finalized
- **Fix:** Checks-Effects-Interactions pattern

#### SOL-018: Flash Loan Vulnerability
- **Severity:** CRITICAL (5)
- **Detection Pattern:** No flash loan guard
- **Attack:** Manipulate state within single tx
- **Fix:** Add reentrancy lock or flash loan detection

#### SOL-019: Oracle Price Manipulation
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Single oracle or spot price
- **Attack:** Manipulate price feed
- **Fix:** Use TWAP or multiple oracles

#### SOL-020: Stale Oracle Data
- **Severity:** HIGH (4)
- **Detection Pattern:** No timestamp check on oracle
- **Attack:** Use outdated prices
- **Fix:** Check price freshness

---

### Token Security

#### SOL-021: Unprotected Mint Authority
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Mint without authority check
- **Attack:** Infinite token minting
- **Fix:** Validate mint authority

#### SOL-022: Freeze Authority Issues
- **Severity:** HIGH (4)
- **Detection Pattern:** Freeze authority mishandled
- **Attack:** Lock user funds maliciously
- **Fix:** Proper freeze authority management

#### SOL-023: Token Account Confusion
- **Severity:** HIGH (4)
- **Detection Pattern:** Token account mint not validated
- **Attack:** Pass wrong token type
- **Fix:** Validate token account mint

#### SOL-024: Missing Token Validation
- **Severity:** HIGH (4)
- **Detection Pattern:** Token not verified before use
- **Attack:** Use counterfeit tokens
- **Fix:** Full token account validation

#### SOL-031: Unlimited Token Mint
- **Severity:** CRITICAL (5)
- **Detection Pattern:** No mint cap
- **Attack:** Hyperinflation
- **Fix:** Implement supply limits

#### SOL-032: Missing Decimals Check
- **Severity:** MEDIUM (3)
- **Detection Pattern:** Decimal mismatch in calculations
- **Attack:** Amount manipulation
- **Fix:** Normalize decimals

---

### MEV & Slippage

#### SOL-033: Missing Slippage Protection
- **Severity:** HIGH (4)
- **Detection Pattern:** Swap without minimum output
- **Attack:** Sandwich attack
- **Fix:** Add minimum output parameter

#### SOL-034: Sandwich Attack Vulnerability
- **Severity:** HIGH (4)
- **Detection Pattern:** Predictable swap order
- **Attack:** Front-run and back-run
- **Fix:** Slippage limits and commit-reveal

#### SOL-035: Front-Running Vulnerability
- **Severity:** HIGH (4)
- **Detection Pattern:** Value extraction from pending tx
- **Attack:** Copy and front-run trades
- **Fix:** Private mempools or commit-reveal

#### SOL-051: Missing Deadline Check
- **Severity:** MEDIUM (3)
- **Detection Pattern:** No transaction deadline
- **Attack:** Stale transaction execution
- **Fix:** Add deadline parameter

---

### Account Management

#### SOL-009: Account Closing Issues
- **Severity:** HIGH (4)
- **Detection Pattern:** Account closed unsafely
- **Attack:** Account revival attack
- **Fix:** Zero data and transfer in same ix

#### SOL-010: Sysvar Address Issues
- **Severity:** MEDIUM (3)
- **Detection Pattern:** Sysvar from parameter not ID
- **Attack:** Fake sysvar injection
- **Fix:** Use sysvar ID constants

#### SOL-025: Lamport Balance Drain
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Lamport access without check
- **Attack:** Drain account lamports
- **Fix:** Validate lamport operations

#### SOL-028: Account Resurrection
- **Severity:** HIGH (4)
- **Detection Pattern:** Closed account reusable
- **Attack:** Revive account for replay
- **Fix:** Prevent resurrection

#### SOL-048: Account Hijacking
- **Severity:** CRITICAL (5)
- **Detection Pattern:** Account ownership transferable
- **Attack:** Take over user accounts
- **Fix:** Immutable ownership or guards

---

### Miscellaneous

#### SOL-036: Missing Amount Validation
- **Severity:** HIGH (4)
- **Detection Pattern:** No bounds on input amounts
- **Attack:** Zero or max value attacks
- **Fix:** Validate amount ranges

#### SOL-042: Missing Pause Mechanism
- **Severity:** MEDIUM (3)
- **Detection Pattern:** No emergency pause
- **Attack:** Cannot stop exploit in progress
- **Fix:** Add pause functionality

#### SOL-043: Hardcoded Address
- **Severity:** LOW (2)
- **Detection Pattern:** Fixed addresses in code
- **Attack:** Cannot update addresses
- **Fix:** Use configurable accounts

#### SOL-044: Missing Event Emission
- **Severity:** LOW (2)
- **Detection Pattern:** State change without event
- **Attack:** Poor observability
- **Fix:** Emit events on changes

#### SOL-046: Time Manipulation Risk
- **Severity:** MEDIUM (3)
- **Detection Pattern:** Clock dependency
- **Attack:** Manipulate timing
- **Fix:** Use slot instead of timestamp

#### SOL-049: LP Token Manipulation
- **Severity:** HIGH (4)
- **Detection Pattern:** LP mint/burn unchecked
- **Attack:** Dilute or drain LP
- **Fix:** Validate LP operations

#### SOL-050: Reward Calculation Error
- **Severity:** HIGH (4)
- **Detection Pattern:** Reward math issues
- **Attack:** Claim excess rewards
- **Fix:** Accurate reward calculation

#### SOL-052: Governance Attack
- **Severity:** HIGH (4)
- **Detection Pattern:** Weak governance
- **Attack:** Flash loan governance
- **Fix:** Time-locks and quorums

---

## Detection Implementation

Each pattern is implemented in `vulnerability_db.rs` with:

```rust
pub struct VulnerabilityPattern {
    pub id: String,
    pub name: String,
    pub severity: u8,
    pub check_fn: fn(&str) -> Option<VulnerabilityFinding>,
}
```

Patterns use AST analysis via the `syn` crate and text pattern matching.

---

## Adding New Patterns

1. Add entry to `vulnerability_db.rs`
2. Implement `check_fn` returning `Option<VulnerabilityFinding>`
3. Add tests in `tests/` directory
4. Update this documentation

---

*Reference document for Solana Security Swarm v0.1.0*
